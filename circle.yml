machine:
  environment:
    PHALCON_VERSION: "2.0.1"
  php:
    version: 5.5.9

dependencies:
  pre:
    - git clone -q --depth=1 https://github.com/phalcon/cphalcon.git -b phalcon-v${PHALCON_VERSION}
    - (cd cphalcon/ext; export CFLAGS="-g3 -O1 -fno-delete-null-pointer-checks -Wall"; phpize &> /dev/null && ./configure --silent --enable-phalcon &> /dev/null && make --silent -j4 > /dev/null && make --silent install && phpenv config-add ../unit-tests/ci/phalcon.ini &> /dev/null)
    - php -r 'echo \Phalcon\Version::get()."\n";'

  cache_directories:
    - vendor
    - $HOME/.composer/cache

test:
  override:
    - mkdir -p $CIRCLE_TEST_REPORTS/phpunit
    - phpunit --bootstrap ./tests/phpUnitBootstrap.php --log-junit $CIRCLE_TEST_REPORTS/phpunit/junit.xml tests/
